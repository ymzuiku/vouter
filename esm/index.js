var I=Object.defineProperty;var l=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var v=(t,e,r)=>e in t?I(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,c=(t,e)=>{for(var r in e||(e={}))y.call(e,r)&&v(t,r,e[r]);if(l)for(var r of l(e))S.call(e,r)&&v(t,r,e[r]);return t};var w=(t,e)=>{var r={};for(var n in t)y.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&l)for(var n of l(t))e.indexOf(n)<0&&S.call(t,n)&&(r[n]=t[n]);return r};import*as s from"react";import{lazy as A}from"react";import{Suspense as H,useMemo as D}from"react";import{CreateObserver as M,useObserver as F}from"react-ob";var R=[],O=t=>{R.push(t)};["popstate","pushState","replaceState","backState"].forEach(t=>{window.addEventListener(t,()=>{t==="popstate"&&o.stack.pop(),R.forEach(e=>{e(t,o.stack)})})});var T=t=>{o.stack.push(t),o.useHash&&(t="/#"+t),history.pushState(null,"",t),window.dispatchEvent(new Event("pushState"))},x=t=>{o.stack.length>0&&o.stack.pop(),o.stack.push(t),o.useHash&&(t="/#"+t),history.replaceState(null,"",t),window.dispatchEvent(new Event("replaceState"))},U=()=>{let t=o.stack[o.stack.length-1];o.stack.length===1&&(t=o.onLastBack(t),o.stack[o.stack.length-1]=t),o.stack.length>1&&o.stack.pop(),o.useHash&&(t="/#"+t),history.replaceState(null,"",t),window.dispatchEvent(new Event("backState"))},B=t=>{o.stack=[t],x(t)},o={push:T,replace:x,goBack:U,clearTo:B,listen:O,onLastBack:t=>t,stack:[],useHash:!1};var g=M({n:0});o.listen(()=>{g.val.n+=1,g.next()});function J(){return s.createElement("div",{style:{padding:100,margin:"0px auto",textAlign:"center"}},s.createElement("div",null,"Not found page"),s.createElement("button",{style:{padding:"8px 16px",outline:"none",background:"#ddd",margin:20,borderRadius:10},onClick:()=>{i.clearTo("/")}},"Go Home"))}function b(t){t.preventDefault(),t.stopPropagation()}var E={};function X({last:t,path:e,Component:r,notKeep:n,preload:a,preloadDelay:u}){return D(()=>{let h=o.stack.indexOf(e)*100;return n&&!t?null:(a&&!E[e]&&(E[e]=!0,setTimeout(()=>{a.forEach(i.preload)},u||500)),s.createElement(H,{key:e,fallback:s.createElement("div",null)},s.createElement("div",{"data-path":e,style:{zIndex:h,position:"absolute",width:"100%",height:"100%",left:0,top:0,visibility:t?"visible":"hidden"},onTouchStart:t?void 0:b,onMouseDown:t?void 0:b},s.createElement(r,{path:e}))))},[t,e])}function P({NotFoundComponent:t=J}){o.stack.length||(o.stack=[i.nowFullUrl()]),F(g,r=>[r.n]);let e=o.stack.length-1;return s.createElement(s.Fragment,null,o.stack.map((r,n)=>{let a=p[r.split("?")[0]];return a?s.createElement(X,c({last:e===n,key:r+n},a)):s.createElement(t,{key:r+n})}))}var L=(t,e={})=>{let r={};return Object.keys(t).forEach(n=>{r[n]=n;let k=t[n],{render:a}=k,u=w(k,["render"]),h=c({path:n,render:a,Component:A(a)},u);p[n]=h}),{paths:r,Router:()=>s.createElement(P,c({},e))}};var f;function d(){let t=navigator.userAgent.toLocaleLowerCase();return f=new RegExp("(iphone|ipod|ipad)").test(t)&&new RegExp("(micromessenger)").test(t),f}o.useHash=!0;var C={},p={},N=t=>{if(typeof window=="undefined"||window.isTest||C[t])return;let e=p[t];if(!e){console.error(`[create-react-ssx] ${t} isn't Router`);return}return C[t]=!0,e.render()};function m(t,e){return e?t+"?"+new URLSearchParams(e).toString():t}var i={search:()=>{let t=location.href.split("#")[0].split("?");return t.length<2?new URLSearchParams:new URLSearchParams(t[1])},hashSearch:()=>{let t=location.href.split("#")[1].split("?");return t.length<2?new URLSearchParams:new URLSearchParams(t[1])},nowUrl:()=>{if(!location.hash)return"/";let t=location.hash.split("#");return t.length<2?"/":t[1].split("?")[0]},nowFullUrl:()=>{if(!location.hash)return"/";let t=location.hash.split("#");return t.length<2?"/":t[1]},push:(t,e)=>{d()?i.replace(t,e):o.push(m(t,e))},replace:(t,e)=>{o.replace(m(t,e))},goBack:()=>{d()?i.replace(o.stack[o.stack.length-1]):o.goBack()},clearTo:(t,e)=>{o.clearTo(m(t,e))},preload:N,isIOSWechat:d,create:L,setOnLastBack:t=>{o.onLastBack=t}};export{p as routeMap,i as vouter};
