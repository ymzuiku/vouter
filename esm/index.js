var T=Object.defineProperty,B=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var x=(t,e,o)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,c=(t,e)=>{for(var o in e||(e={}))y.call(e,o)&&x(t,o,e[o]);if(h)for(var o of h(e))v.call(e,o)&&x(t,o,e[o]);return t},R=(t,e)=>B(t,O(e));var E=(t,e)=>{var o={};for(var n in t)y.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&h)for(var n of h(t))e.indexOf(n)<0&&v.call(t,n)&&(o[n]=t[n]);return o};import*as s from"react";import{lazy as K}from"react";var p={};import{createContext as A,Suspense as N,useContext as W,useMemo as z}from"react";import{CreateObserver as j,useObserver as G}from"react-ob";var b=[],H=t=>{b.push(t)};["popstate","pushState","replaceState","backState"].forEach(t=>{window.addEventListener(t,()=>{t==="popstate"&&r.stack.pop(),b.forEach(e=>{e(t,r.stack)})})});var l=t=>({url:t,path:t.split("?")[0],time:Date.now(),index:r.stack.length}),M=t=>{r.stack.forEach(e=>{e.tempData=void 0}),r.stack.push(l(t)),r.useHash&&(t="/#"+t),history.pushState(null,"",t),window.dispatchEvent(new Event("pushState"))},P=(t,e)=>{if(r.stack.forEach(o=>{o.tempData=void 0}),r.stack.length>0&&r.stack.pop(),r.stack.push(l(t)),r.useHash&&(t="/#"+t),e){let o=r.stack[r.stack.length-1];o.tempData=e}history.replaceState(null,"",t),window.dispatchEvent(new Event("replaceState"))},F=t=>{r.stack.length>1&&r.stack.pop();let e=r.stack[r.stack.length-1];if(r.stack.length===1){let n=e.time,i=e.url;e=l(r.onLastBack(e)),i===e.url&&(e.time=n),r.stack[r.stack.length-1]=e}let o=e.url;r.useHash&&(o="/#"+e.url),t&&(r.stack[r.stack.length-1].tempData=t),history.replaceState(null,"",o),window.dispatchEvent(new Event("backState"))},J=t=>{r.stack=[l(t)],P(t)},r={push:M,replace:P,goBack:F,clearTo:J,listen:H,onLastBack:t=>t.url,newStack:l,stack:[],useHash:!1};function m(t,e){return e?t+"?"+new URLSearchParams(e).toString():t}var g;function d(){let t=navigator.userAgent.toLocaleLowerCase();return g=new RegExp("(iphone|ipod|ipad)").test(t)&&new RegExp("(micromessenger)").test(t),g}r.useHash=!0;var C={},X=t=>{if(typeof window=="undefined"||window.isTest||C[t])return;let e=p[t];if(!e){console.error(`[create-react-ssx] ${t} isn't Router`);return}return C[t]=!0,e.render()},a={search:()=>{let t=location.href.split("#")[0].split("?");return t.length<2?new URLSearchParams:new URLSearchParams(t[1])},hashSearch:()=>{let t=location.href.split("#")[1].split("?");return t.length<2?new URLSearchParams:new URLSearchParams(t[1])},nowUrl:()=>{if(!location.hash)return"/";let t=location.hash.split("#");return t.length<2?"/":t[1].split("?")[0]},nowFullUrl:()=>{if(!location.hash)return"/";let t=location.hash.split("#");return t.length<2?"/":t[1]},push:(t,e)=>{d()?a.replace(t,e):r.push(m(t,e))},replace:(t,e,o)=>{r.replace(m(t,e),o)},goBack:t=>{d()?a.replace(r.stack[r.stack.length-1].url,t):r.goBack(t)},clearTo:(t,e)=>{r.clearTo(m(t,e))},preload:X,newStack:r.newStack,isIOSWechat:d,getStack:()=>r.stack,getLastStack:()=>r.stack[r.stack.length-1],isBack:()=>{let t=a.getLastStack();return t.url===a.nowFullUrl()?t.time+100<Date.now():!1},setOnLastBack:t=>{r.onLastBack=t}};var S=j({n:0});r.listen(()=>{S.val.n+=1,S.next()});function _(){return s.createElement("div",{style:{padding:100,margin:"0px auto",textAlign:"center"}},s.createElement("div",null,"Not found page"),s.createElement("button",{style:{padding:"8px 16px",outline:"none",background:"#ddd",margin:20,borderRadius:10},onClick:()=>{a.clearTo("/")}},"Go Home"))}function L(t){t.preventDefault(),t.stopPropagation()}var D={},U=A({stack:r.newStack("/"),isBack:!1,last:!1});function $(){return W(U)}function q({last:t,path:e,stack:o,Component:n,notKeep:i,preload:u,preloadDelay:k}){return z(()=>{if(i&&!t)return null;let f=o.index*100;return u&&!D[e]&&(D[e]=!0,setTimeout(()=>{u.forEach(a.preload)},k||500)),s.createElement(U.Provider,{value:{stack:o,isBack:t&&o.time+100<Date.now(),last:t}},s.createElement(N,{key:e,fallback:s.createElement("div",null)},s.createElement("div",{"data-path":e,style:{zIndex:f,position:"absolute",width:"100%",height:"100%",left:0,top:0},onTouchStart:t?void 0:L,onMouseDown:t?void 0:L},s.createElement(n,null))))},[t,o.url])}function w({NotFoundComponent:t=_}){r.stack.length||(r.stack=[a.newStack(a.nowFullUrl())]),G(S,o=>[o.n]);let e=r.stack.length-1;return s.createElement(s.Fragment,null,r.stack.map((o,n)=>{let i=p[o.path];return i?s.createElement(q,c({last:e===n,key:o.url+n,stack:o},i)):s.createElement(t,{key:o.url+n})}))}var I=(t,e={})=>{let o={};return Object.keys(t).forEach(n=>{o[n]=n;let f=t[n],{render:i}=f,u=E(f,["render"]),k=c({path:n,render:i,Component:K(i)},u);p[n]=k}),{paths:o,Router:()=>s.createElement(w,c({},e))}};var vt=R(c({},a),{create:I});export{w as Router,$ as useHistoryChange,vt as vouter};
