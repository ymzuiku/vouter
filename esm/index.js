var O=Object.defineProperty;var l=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var w=(t,e,r)=>e in t?O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,p=(t,e)=>{for(var r in e||(e={}))S.call(e,r)&&w(t,r,e[r]);if(l)for(var r of l(e))v.call(e,r)&&w(t,r,e[r]);return t};var R=(t,e)=>{var r={};for(var n in t)S.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&l)for(var n of l(t))e.indexOf(n)<0&&v.call(t,n)&&(r[n]=t[n]);return r};import*as s from"react";import{lazy as N}from"react";import{Suspense as D,useMemo as M}from"react";import{CreateObserver as J,useObserver as X}from"react-ob";var x=[],T=t=>{x.push(t)};["popstate","pushState","replaceState","backState"].forEach(t=>{window.addEventListener(t,()=>{t==="popstate"&&o.stack.pop(),x.forEach(e=>{e(t,o.stack)})})});var U=t=>{o.stack.push(t),o.useHash&&(t="/#"+t),history.pushState(null,"",t),window.dispatchEvent(new Event("pushState"))},b=t=>{o.stack.length>0&&o.stack.pop(),o.stack.push(t),o.useHash&&(t="/#"+t),history.replaceState(null,"",t),window.dispatchEvent(new Event("pushState"))},B=()=>{let t=o.stack[o.stack.length-1];o.stack.length===1&&(t=o.onLastBack(t),o.stack[o.stack.length-1]=t),o.stack.length>1&&o.stack.pop(),o.useHash&&(t="/#"+t),history.replaceState(null,"",t),window.dispatchEvent(new Event("backState"))},H=t=>{o.stack=[t],b(t)},o={push:U,replace:b,goBack:B,clearTo:H,listen:T,onLastBack:t=>t,stack:[],useHash:!1};var g=J({n:0});o.listen(()=>{g.val.n+=1,g.next()});function A(){return s.createElement("div",{style:{padding:100,margin:"0px auto",textAlign:"center"}},s.createElement("div",null,"Not found page"),s.createElement("button",{style:{padding:"8px 16px",outline:"none",background:"#ddd",margin:20,borderRadius:10},onClick:()=>{i.clearTo("/")}},"Go Home"))}function E(t){t.preventDefault(),t.stopPropagation()}var P={};function F({last:t,path:e,Component:r,notKeep:n,preload:a,preloadDelay:c}){return M(()=>{let h=o.stack.indexOf(e)*100;return n&&!t?null:(a&&!P[e]&&(P[e]=!0,setTimeout(()=>{a.forEach(i.preload)},c||500)),s.createElement(D,{key:e,fallback:s.createElement("div",null)},s.createElement("div",{"data-path":e,style:{zIndex:h,position:"absolute",width:"100%",height:"100%",left:0,top:0,visibility:t?"visible":"hidden"},onTouchStart:t?void 0:E,onMouseDown:t?void 0:E},s.createElement(r,{path:e}))))},[t,e])}function I({NotFoundComponent:t=A}){o.stack=[i.nowUrl()],X(g,r=>[r.n]);let e=o.stack.length-1;return s.createElement(s.Fragment,null,o.stack.map((r,n)=>{let a=u[r];return a?s.createElement(F,p({last:e===n,key:r+n},a)):s.createElement(t,{key:r+n})}))}var L=(t,e={})=>{let r={},n=[];return Object.keys(t).forEach(a=>{r[a]=a;let y=t[a],{render:c}=y,h=R(y,["render"]),k=p({path:a,render:c,Component:N(c)},h);n.push(k),u[a]=k}),{paths:r,Router:()=>s.createElement(I,p({},e))}};var d;function f(){let t=navigator.userAgent.toLocaleLowerCase();return d=new RegExp("(iphone|ipod|ipad)").test(t)&&new RegExp("(micromessenger)").test(t),d}o.useHash=!0;var C={},u={},W=t=>{if(typeof window=="undefined"||window.isTest||C[t])return;let e=u[t];if(!e){console.error(`[create-react-ssx] ${t} isn't Router`);return}return C[t]=!0,e.render()};function m(t,e){return e?t+"?"+new URLSearchParams(e).toString():t}var i={search:()=>{let t=location.href.split("#")[0].split("?");return t.length<2?new URLSearchParams:new URLSearchParams(t[1])},hashSearch:()=>{let t=location.href.split("#")[1].split("?");return t.length<2?new URLSearchParams:new URLSearchParams(t[1])},nowUrl:()=>{if(!location.hash)return"/";let t=location.hash.split("#");return t.length<2?"/":t[1].split("?")[0]},nowFullUrl:()=>{if(!location.hash)return"/";let t=location.hash.split("#");return t.length<2?"/":t[1]},push:(t,e)=>{f()?i.replace(t,e):o.push(m(t,e))},replace:(t,e)=>{o.replace(m(t,e))},goBack:()=>{f()?i.replace(o.stack[o.stack.length-1]):o.goBack()},clearTo:(t,e)=>{o.clearTo(m(t,e))},preload:W,isIOSWechat:f,create:L,setOnLastBack:t=>{o.onLastBack=t}};export{u as routeMap,i as vouter};
